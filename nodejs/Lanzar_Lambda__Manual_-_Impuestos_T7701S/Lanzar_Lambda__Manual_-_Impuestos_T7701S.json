{"task":{"enable":true,"type":"script","public":false,"tags":["sch"],"grace_time":0,"task_arguments":[{"id":1,"order":0,"type":"fixed","label":"Filename Prefix","value":"T7701S","help":"","readonly":true,"required":true,"masked":false,"options":[]},{"id":2,"order":1,"type":"date","label":"fecha","help":"","readonly":false,"required":true,"masked":false,"options":[]}],"output_parameters":[],"register_body":false,"execution_count":5,"multitasking":true,"user_inputs":false,"user_inputs_members":[],"show_result":false,"script_arguments":[{"id":1,"order":0,"type":"fixed","label":"Filename Prefix","value":"T7701S","help":"","readonly":true,"required":true,"masked":false,"options":[]},{"id":2,"order":1,"type":"date","label":"fecha","help":"","readonly":false,"required":true,"masked":false,"options":[]}],"logging":false,"_type":"ScriptTask","creation_date":"2020-08-28T19:39:49.424Z","last_update":"2020-09-09T23:46:45.667Z","env":{"AWS_ACCESS_KEY_ID":"AKIAUGN4GKVMLTUY7IJB","AWS_SECRET_ACCESS_KEY":"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","AWS_S3_BUCKET_DIRECTORY":"wallet/compensacion/input/GP","AWS_REGION":"us-east-1"},"script_runas":"\"/usr/bin/node\" %script%","name":"Lanzar Lambda  Manual - Impuestos T7701S","description":"","timeout":600000,"template_id":null,"template":null,"source_model_id":"5f495d850ffe1b0012fa32e2","script_id":"5f4e629c0ffe1b0012fb2853"},"file":{"filename":"lambda_generico.js","keyname":"lambda_generico.js[ts:1599687268732]","mimetype":"text/javascript","extension":"js","size":1860,"description":"Arg 1: Prefijo del archivo\nArg 2: Date","md5":"632b60119e67502e098f57454feafd94","public":false,"tags":[],"source_model_id":"5f4e629c0ffe1b0012fb2853","data":"Y29uc3QgQVdTID0gcmVxdWlyZSgnYXdzLXNkaycpCmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKQpjb25zdCBqb2luID0gcmVxdWlyZSgncGF0aCcpLmpvaW4KY29uc3QgZmlsZW5hbWVQcmVmaXggPSBwcm9jZXNzLmFyZ3ZbMl0KY29uc3QgbWFudWFsRGF0ZSA9IHByb2Nlc3MuYXJndlszXQoKY29uc3QgbWFpbiA9IGFzeW5jICgpID0+IHsKICB0cnkgewogICAgY29uc3QgZGlyZWN0b3J5ID0gcHJvY2Vzcy5lbnYuQVdTX1MzX0JVQ0tFVF9ESVJFQ1RPUlkKICAgIGxldCBkYXRlCgogICAgaWYgKG1hbnVhbERhdGUpIHsKICAgICAgLy9pZiAobmV3IERhdGUoIG1hbnVhbERhdGUgKSAgPT09ICJNaXNzaW5nIHJlZ2lvbiBpbiBjb25maWciKSAKICAgICAgZGF0ZSA9IGF3YWl0IHBhcnNlTWFudWFsRGF0ZShtYW51YWxEYXRlKQogICAgfSBlbHNlIHsKICAgICAgZGF0ZSA9IGF3YWl0IGdldFRvZGF5KCkKICAgIH0KCiAgICBsZXQgbGFtYmRhID0gbmV3IEFXUy5MYW1iZGEoewogICAgICBhY2Nlc3NLZXlJZDogcHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVlfSUQsCiAgICAgIHNlY3JldEFjY2Vzc0tleTogcHJvY2Vzcy5lbnYuQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZLAogICAgICByZWdpb246IHByb2Nlc3MuZW52LkFXU19SRUdJT04KICAgIH0pCgogICAgbGV0IHBhcmFtcyA9IHsKICAgICAgRnVuY3Rpb25OYW1lOiAnZ3AtY29uY2lsaWF0aW9uLXByb2QnLAogICAgICBQYXlsb2FkOiBgeyAiZmlsZU5hbWVzIiA6ICIke2ZpbGVuYW1lUHJlZml4fV8wOF82MTdfJHtkYXRlfV87IiB9YAogICAgfQoKICAgIGxldCBkYXRhID0gYXdhaXQgbGFtYmRhLmludm9rZShwYXJhbXMpLnByb21pc2UoKQogICAgbGV0IGZpbGVuYW1lID0gSlNPTi5wYXJzZShKU09OLnBhcnNlKGRhdGEuUGF5bG9hZCkuYm9keSkuZG93bmxvYWRlZE9rWzBdCgogICAgbGV0IHJlc3VsdCA9IGpvaW4oZGlyZWN0b3J5LCBmaWxlbmFtZSkKICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHsgc3RhdGU6ICdzdWNjZXNzJywgZGF0YTogW3Jlc3VsdF0gfSkpCiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLmxvZyhlcnIpCiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh7IHN0YXRlOiAnZmFpbHVyZScsIGRhdGE6IFtlcnIubWVzc2FnZV0gfSkpCiAgICBwcm9jZXNzLmV4aXQoKQogIH0KfQoKY29uc3QgcGFyc2VNYW51YWxEYXRlID0gYXN5bmMgKG1hbnVhbERhdGUpPT57CiAgbGV0IGRhdGUgPSBuZXcgRGF0ZShtYW51YWxEYXRlKQogIGxldCBkZCA9ICgiMCIgKyBkYXRlLmdldERhdGUoKSkuc2xpY2UoLTIpCiAgbGV0IG1tID0gKCIwIiArIChkYXRlLmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpCiAgbGV0IHl5eXkgPSBkYXRlLmdldEZ1bGxZZWFyKCkKICByZXR1cm4gZGF0ZSA9IGAke3l5eXl9JHttbX0ke2RkfWAKfQoKY29uc3QgZ2V0VG9kYXkgPSBhc3luYyAoKSA9PiB7CiAgbGV0IHRvZGF5ID0gbmV3IERhdGUoKQogIGxldCBkZCA9ICgiMCIgKyB0b2RheS5nZXREYXRlKCkpLnNsaWNlKC0yKQogIGxldCBtbSA9ICgiMCIgKyAodG9kYXkuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikKICBsZXQgeXl5eSA9IHRvZGF5LmdldEZ1bGxZZWFyKCkKICByZXR1cm4gdG9kYXkgPSBgJHt5eXl5fSR7bW19JHtkZH1gCn0KCmNvbnN0IGZhaWx1cmVPdXRwdXQgPSAoZXJyKSA9PiB7CiAgbGV0IG91dHB1dCA9IHsKICAgIHN0YXRlOiAiZmFpbHVyZSIsCiAgICBkYXRhOiB7CiAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlLAogICAgICBjb2RlOiBlcnIuY29kZSwKICAgICAgZGF0YTogZXJyLmRhdGEgCiAgICB9CiAgfQogIGNvbnNvbGUuZXJyb3IoSlNPTi5zdHJpbmdpZnkob3V0cHV0KSkKfQoKbWFpbigp"}}