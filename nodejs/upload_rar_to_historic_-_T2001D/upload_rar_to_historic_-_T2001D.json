{"task":{"enable":true,"type":"script","public":false,"tags":[],"grace_time":0,"task_arguments":[{"id":1,"order":0,"type":"input","label":"file","help":"","readonly":false,"required":true,"masked":false,"charsmin":0,"charsmax":0,"charset":null,"pattern":"","options":[]},{"id":2,"order":1,"type":"fixed","label":"type","value":"file","help":"","readonly":true,"required":true,"masked":false,"options":[]}],"output_parameters":[],"register_body":false,"execution_count":0,"multitasking":true,"user_inputs":false,"user_inputs_members":[],"show_result":false,"script_arguments":[{"id":1,"order":0,"type":"input","label":"file","help":"","readonly":false,"required":true,"masked":false,"charsmin":0,"charsmax":0,"charset":null,"pattern":"","options":[]},{"id":2,"order":1,"type":"fixed","label":"type","value":"file","help":"","readonly":true,"required":true,"masked":false,"options":[]}],"logging":false,"_type":"ScriptTask","creation_date":"2020-08-28T19:39:49.497Z","last_update":"2020-08-28T20:13:37.500Z","script_runas":"\"/usr/bin/node\" %script%","name":"upload rar to historic - T2001D","description":"","timeout":600000,"template_id":null,"template":null,"source_model_id":"5f495d850ffe1b0012fa3308","env":{},"script_id":"5f495aec9b9af000129c0fac"},"file":{"filename":"uploadToS3V2.js","keyname":"uploadToS3V2.js[ts:1598643592043]","mimetype":"text/javascript","extension":"js","size":2676,"description":"","md5":"581595a9e3b43aafceae49ea506c22cb","public":false,"tags":[],"source_model_id":"5f495aec9b9af000129c0fac","data":"Y29uc3QgZnMgPSByZXF1aXJlKCdmcycpCmNvbnN0IEFXUyA9IHJlcXVpcmUoJ2F3cy1zZGsnKQpjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpCgpsZXQgczMKCmNvbnN0IG1haW4gPSBhc3luYyAoKSA9PiB7CiAgdHJ5IHsKICAgIHMzID0gbmV3IEFXUy5TMyh7CiAgICAgIGFjY2Vzc0tleUlkOiBwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWV9JRCAsCiAgICAgIHNlY3JldEFjY2Vzc0tleTogcHJvY2Vzcy5lbnYuQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZICwKICAgICAgcmVnaW9uOiBwcm9jZXNzLmVudi5BV1NfUkVHSU9OIAogICAgfSkKCiAgICBjb25zdCBidWNrZXQgPSBwcm9jZXNzLmVudi5BV1NfUzNfQlVDS0VUIAogICAgY29uc3QgYnVja2V0RGlyZWN0b3J5ID0gcHJvY2Vzcy5lbnYuQVdTX1MzX0JVQ0tFVF9ESVJFQ1RPUlkgIAogICAgY29uc3Qgb3JpZ2luUGF0aCA9IHByb2Nlc3MuYXJndlsyXQogICAgY29uc3QgZmlsZVR5cGUgPSBwcm9jZXNzLmFyZ3ZbM10KICAgIGNvbnN0IHVwbG9hZGVkUGF0aCA9IHByb2Nlc3MuYXJndls0XQoKICAgIGxldCBzdGF0ID0gZnMuc3RhdFN5bmMob3JpZ2luUGF0aCkKICAgIGxldCBvcHRpb25zID0ge30KICAgIGxldCBkYXRhCgoKICAgIGlmIChmaWxlVHlwZSA9PT0gJ2ZpbGUnKSB7CgogICAgICBpZiAoIXN0YXQuaXNGaWxlKCkpIHsKCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYXRoIGlzIG5vdCBmaWxlJykKICAgICAgfQoKICAgICAgbGV0IGZpbGVuYW1lID0gcGF0aC5iYXNlbmFtZShvcmlnaW5QYXRoKQogICAgICBvcHRpb25zID0gewogICAgICAgIGJ1Y2tldCwKICAgICAgICBrZXk6IHBhdGguam9pbihidWNrZXREaXJlY3RvcnksIGZpbGVuYW1lKSwKICAgICAgICBmaWxlOiBvcmlnaW5QYXRoCiAgICAgIH0KICAgICAgYXdhaXQgdXBsb2FkRmlsZVMzKG9wdGlvbnMpCgogICAgICBpZiAodXBsb2FkZWRQYXRoKSB7CiAgICAgICAgbGV0IGRlc3Rpbm8gPSB1cGxvYWRlZFBhdGggLy9tbnQvZGF0YS91cGxvYWR1bnJhcmZpbGVXRi91cGxvYWRlZC8KICAgICAgICBsZXQgb3JpZ2VuID0gb3JpZ2luUGF0aCAvL21udC9kYXRhL3VwbG9hZHVucmFyZmlsZVdGL2V4dHJhY3RlZC90ZXN0LnR4dAogICAgICAgIG1vdmVGaWxlcyhvcmlnZW4sIGRlc3Rpbm8pCiAgICAgICAgZGF0YSA9IHBhdGguam9pbih1cGxvYWRlZFBhdGgsIGZpbGVuYW1lKQogICAgICB9CgoKCiAgICB9IGVsc2UgaWYgKGZpbGVUeXBlID09PSAnZGlyZWN0b3J5JykgewoKICAgICAgaWYgKCFzdGF0LmlzRGlyZWN0b3J5KCkpIHsKCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYXRoIGlzIG5vdCBkaXJlY3RvcnknKQoKICAgICAgfQoKCgogICAgICBsZXQgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhvcmlnaW5QYXRoKQoKICAgICAgaWYgKHBhdGgpCiAgICAgICAgZm9yIChsZXQgZmlsZW5hbWUgb2YgZmlsZXMpIHsKICAgICAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgICAgIGJ1Y2tldCwKICAgICAgICAgICAga2V5OiBwYXRoLmpvaW4oYnVja2V0RGlyZWN0b3J5LCBmaWxlbmFtZSksCiAgICAgICAgICAgIGZpbGU6IHBhdGguam9pbihvcmlnaW5QYXRoLCBmaWxlbmFtZSkKICAgICAgICAgIH0KICAgICAgICAgIGF3YWl0IHVwbG9hZEZpbGVTMyhvcHRpb25zKQoKCiAgICAgICAgICBpZiAodXBsb2FkZWRQYXRoKSB7CiAgICAgICAgICAgIGxldCBvcmlnZW4gPSBwYXRoLmpvaW4ob3JpZ2luUGF0aCwgZmlsZW5hbWUpCiAgICAgICAgICAgIGxldCBkZXN0aW5vID0gdXBsb2FkZWRQYXRoCiAgICAgICAgICAgIG1vdmVGaWxlcyhvcmlnZW4sIGRlc3Rpbm8pICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgfQoKICAgICAgICB9CgogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGZpbGUgVHlwZSB1bnN1cHBvcnRlZCcpCiAgICB9CiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh7IHN0YXRlOiAnc3VjY2VzcycsIGRhdGE6IFtvcmlnaW5QYXRoXSB9KSkKICB9IGNhdGNoIChlcnIpIHsKICAgIGNvbnNvbGUubG9nKGVycikKICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHsgc3RhdGU6ICdmYWlsdXJlJywgZGF0YTogW2Vyci5tZXNzYWdlXSB9KSkKICAgIHByb2Nlc3MuZXhpdCgpCiAgfQp9Cgpjb25zdCB1cGxvYWRGaWxlUzMgPSBhc3luYyAoeyBidWNrZXQsIGtleSwgZmlsZSB9KSA9PiB7CiAgbGV0IHN0cmVhbSA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0oZmlsZSkgLy8gdXNlIHN0cmVhbXMgZm9yIGJldHRlciBwZXJmb3JtYW5jZQoKICBjb25zdCBwYXJhbXMgPSB7CiAgICBCdWNrZXQ6IGJ1Y2tldCwKICAgIEtleToga2V5LAogICAgQm9keTogc3RyZWFtCiAgfQoKICBjb25zdCByZXN1bHQgPSBhd2FpdCBzMy51cGxvYWQocGFyYW1zKS5wcm9taXNlKCkKICBjb25zb2xlLmxvZyhgRmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVsbHkgYXQgJHtyZXN1bHQuTG9jYXRpb259YCkKfQoKCmNvbnN0IG1vdmVGaWxlcyA9IChvcmlnZW4sIGRlc3Rpbm8pID0+IHsKICBpZiAoIWZzLmV4aXN0c1N5bmMoZGVzdGlubykpIHsKICAgIGZzLm1rZGlyU3luYyhkZXN0aW5vKQogIH0KCiAgZGVzdGlubyA9IHBhdGguam9pbihkZXN0aW5vLCBwYXRoLmJhc2VuYW1lKG9yaWdlbikpCiAgZnMucmVuYW1lU3luYyhvcmlnZW4sIGRlc3Rpbm8pCn0KCgptYWluKCkK"}}