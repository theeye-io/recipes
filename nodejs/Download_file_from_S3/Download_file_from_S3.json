{"task":{"enable":true,"type":"script","public":false,"tags":[],"grace_time":0,"task_arguments":[{"id":1,"order":0,"type":"input","label":"key","help":"","readonly":false,"required":true,"masked":false,"charsmin":0,"charsmax":0,"charset":"all","pattern":"","options":[]},{"id":2,"order":1,"type":"fixed","label":"Delete after download","value":"true","help":"","readonly":true,"required":true,"masked":false,"options":[]}],"output_parameters":[],"register_body":false,"execution_count":43,"multitasking":true,"user_inputs":false,"user_inputs_members":[],"show_result":false,"script_arguments":[{"id":1,"order":0,"type":"input","label":"key","help":"","readonly":false,"required":true,"masked":false,"charsmin":0,"charsmax":0,"charset":"all","pattern":"","options":[]},{"id":2,"order":1,"type":"fixed","label":"Delete after download","value":"true","help":"","readonly":true,"required":true,"masked":false,"options":[]}],"logging":false,"_type":"ScriptTask","creation_date":"2020-08-05T17:42:16.859Z","last_update":"2020-09-07T16:52:16.479Z","env":{"AWS_ACCESS_KEY_ID":"AKIAQFG6TFC77NKOZ7PM","AWS_SECRET_ACCESS_KEY":"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","AWS_REGION":"us-east-1","AWS_S3_BUCKET":"transactions-prod.tunubi.com","DOWNLOADED_PATH":"/mnt/data/uploadunrarfileWF/downloaded"},"name":"Download file from S3","description":"","timeout":600000,"script_runas":"\"/usr/bin/node\" %script%","template":null,"template_id":null,"source_model_id":"5f2aef783816a90012c74484","script_id":"5f2aeed13816a90012c7444e"},"file":{"filename":"downloadS3File.js","keyname":"downloadS3File.js[ts:1597151847401]","mimetype":"text/javascript","extension":"js","size":1526,"description":"","md5":"47431ac2fd80ff4c4157dbe5ec718666","public":false,"tags":[],"source_model_id":"5f2aeed13816a90012c7444e","data":"IyEvdXNyL2xvY2FsL2Jpbi9ub2RlCgpjb25zdCBBV1MgPSByZXF1aXJlKCdhd3Mtc2RrJykKY29uc3QgZnMgPSByZXF1aXJlKCdmcycpCmNvbnN0IGJhc2VuYW1lID0gcmVxdWlyZSgncGF0aCcpLmJhc2VuYW1lOwpjb25zdCBqb2luID0gcmVxdWlyZSgncGF0aCcpLmpvaW47CgoKY29uc3Qgc3RyZWFtID0gcmVxdWlyZSgnc3RyZWFtJyk7CmNvbnN0IHV0aWwgPSByZXF1aXJlKCd1dGlsJyk7CmNvbnN0IHBpcGVsaW5lID0gdXRpbC5wcm9taXNpZnkoc3RyZWFtLnBpcGVsaW5lKTsKbGV0IHMzCgpjb25zdCBrZXkgPSBwcm9jZXNzLmFyZ3ZbMl0KY29uc3QgRG93bmxvYWRQYXRoID0gcHJvY2Vzcy5lbnYuRE9XTkxPQURFRF9QQVRICmNvbnN0IGRlbGV0ZUFmdGVyRG93bmxvYWQgPSBwcm9jZXNzLmFyZ3ZbM10KCgpjb25zdCBtYWluID0gYXN5bmMgKCkgPT4gewogIHRyeSB7CiAgICBzMyA9IG5ldyBBV1MuUzMoewogICAgICBhY2Nlc3NLZXlJZDogcHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVlfSUQsCiAgICAgIHNlY3JldEFjY2Vzc0tleTogcHJvY2Vzcy5lbnYuQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZLAogICAgICByZWdpb246IHByb2Nlc3MuZW52LkFXU19SRUdJT04KICAgIH0pCgogICAgY29uc3QgYnVja2V0ID0gcHJvY2Vzcy5lbnYuQVdTX1MzX0JVQ0tFVAogICAgbGV0IGZpbGVuYW1lID0gYmFzZW5hbWUoa2V5KQogICAgbGV0IHBhdGggPSBqb2luKERvd25sb2FkUGF0aCwgZmlsZW5hbWUpCiAgICBsZXQgZG93bmxvYWRSZXN1bHQgPSBhd2FpdCBkb3dubG9hZFMzRmlsZShidWNrZXQsIGtleSwgcGF0aCkKCiAgICBpZiAoZGVsZXRlQWZ0ZXJEb3dubG9hZCkgewogICAgICBhd2FpdCBkZWxldGVPYmplY3QoYnVja2V0LCBrZXkpCiAgICB9CgogICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoewogICAgICBzdGF0ZTogJ3N1Y2Nlc3MnLAogICAgICBkYXRhOiBbcGF0aF0KICAgIH0pKQogIH0gY2F0Y2ggKGVycikgewogICAgY29uc29sZS5sb2coZXJyKQogIH0KfQoKCmNvbnN0IGRvd25sb2FkUzNGaWxlID0gKGJ1Y2tldCwga2V5LCBwYXRoKSA9PiB7CiAgbGV0IHBhcmFtcyA9IHsKICAgIEJ1Y2tldDogYnVja2V0LAogICAgS2V5OiBrZXkKICB9CgogIGxldCByZWFkU3RyZWFtID0gczMuZ2V0T2JqZWN0KHBhcmFtcykuY3JlYXRlUmVhZFN0cmVhbSgpCiAgbGV0IHdyaXRlclN0cmVhbSA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKHBhdGgsIHsgZmxhZ3M6ICd3JyB9KQogIHJldHVybiBwaXBlbGluZShyZWFkU3RyZWFtLCB3cml0ZXJTdHJlYW0pCn0KCmNvbnN0IGRlbGV0ZU9iamVjdCA9IChidWNrZXQsIGtleSkgPT4gewoKICBsZXQgcGFyYW1zID0gewogICAgQnVja2V0OiBidWNrZXQsCiAgICBLZXk6IGtleQogIH07CiAgcmV0dXJuIHMzLmRlbGV0ZU9iamVjdChwYXJhbXMpLnByb21pc2UoKQogIGNvbnNvbGUubG9nKCdTZSBlbGltaW5vIGVsIGFyY2hpdm8gJyArIGtleSArICcgY29ycmVjdGFtZW50ZScpCn0KCmNvbnN0IG1vdmVyUzNGaWxlID0gKCkgPT4gewp9CgptYWluKCk="}}