{"task":{"enable":true,"type":"script","public":false,"tags":[],"grace_time":0,"task_arguments":[{"id":1,"order":0,"type":"fixed","label":"user","value":"email-user","help":"","readonly":true,"required":true,"masked":false,"options":[]},{"id":2,"order":1,"type":"input","label":"password","help":"","readonly":false,"required":true,"masked":true,"charsmin":0,"charsmax":0,"charset":null,"pattern":"","options":[]}],"output_parameters":[],"register_body":false,"execution_count":0,"multitasking":true,"user_inputs":false,"user_inputs_members":[],"show_result":false,"script_arguments":[{"id":1,"order":0,"type":"fixed","label":"user","value":"email-user","help":"","readonly":true,"required":true,"masked":false,"options":[]},{"id":2,"order":1,"type":"input","label":"password","help":"","readonly":false,"required":true,"masked":true,"charsmin":0,"charsmax":0,"charset":null,"pattern":"","options":[]}],"logging":false,"_type":"ScriptTask","creation_date":"2020-07-06T18:28:04.722Z","last_update":"2020-07-06T18:28:04.724Z","env":{"PATH":"Download pdf path","HOST":"Mail Host","PORT":"PORT","TLS":"boolean"},"name":"Download pdf from email attachments","description":"","timeout":600000,"script_runas":"/usr/bin/env node %script%","source_model_id":"5f036d34a4b84d00138ee3a6","script_id":"5eff3d02f3707500121286ea"},"file":{"filename":"downloadAllAttachments.js","keyname":"downloadAllAttachments.js[ts:1594107442448]","mimetype":"text/javascript","extension":"js","size":3456,"description":"","md5":"cf962840f3e648d81fc7e75de60d9a04","public":false,"tags":[],"source_model_id":"5eff3d02f3707500121286ea","data":"bGV0IGltYXBzID0gcmVxdWlyZSgnaW1hcC1zaW1wbGUnKTsKbGV0IGZzID0gcmVxdWlyZSgnZnMnKTsKY29uc3QgcGF0aCA9IHByb2Nlc3MuZW52LlBBVEg7CmxldCBjb25maWcgPSB7CiAgaW1hcDogewogICAgdXNlcjogcHJvY2Vzcy5hcmd2WzJdLAogICAgcGFzc3dvcmQ6IHByb2Nlc3MuYXJndlszXSwKICAgIGhvc3Q6IHByb2Nlc3MuZW52LkhPU1QsCiAgICBwb3J0OiBwcm9jZXNzLmVudi5QT1JULAogICAgdGxzOiBwcm9jZXNzLmVudi5UTFMsIC8vYm9vbGVhbgogICAgYXV0aFRpbWVvdXQ6IDMwMDAKICB9Cn0KCmNvbnN0IG1haW4gPSBhc3luYyAoKSA9PiB7CiAgdHJ5IHsKICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBpbWFwcy5jb25uZWN0KGNvbmZpZykKICAgIGF3YWl0IGNvbm5lY3Rpb24ub3BlbkJveCgnSU5CT1gnKQogICAgbGV0IG1lc3NhZ2VzID0gYXdhaXQgZmV0Y2hNZXNzYWdlcyhjb25uZWN0aW9uKQogICAgbGV0IGF0dGFjaG1lbnRzID0gYXdhaXQgZXh0cmFjdEF0dGFjaGVtZW50cyhtZXNzYWdlcywgY29ubmVjdGlvbikKICAgIHByb2Nlc3NBdHRhY2htZW50cyhhdHRhY2htZW50cykKICAgIGNvbm5lY3Rpb24uZW5kKCkKICAgIGNvbnN0IG91dHB1dCA9IHsgInN0YXRlIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHt9IH0KICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KG91dHB1dCkpCiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLmVycm9yKGVycikKICAgIGNvbnNvbGUuZXJyb3IoImZhaWx1cmUiKQogICAgY29ubmVjdGlvbi5lbmQoKQogIH0KfQoKY29uc3QgcHJvY2Vzc0F0dGFjaG1lbnRzID0gYXR0YWNobWVudHMgPT4gewoKICBpZiAoY2hlY2tJZkF0dGFjaG1lbnRzRXhpc3RzKCkpIGNvbnNvbGUubG9nKCdObyBzZSBlbmNvbnRyYXJvbiBkb2N1bWVudG9zJykKCiAgY29uc29sZS5sb2coYFNlIGVuY29udGFyb24gbG9zIHNpZ3VpZW50ZXMgZG9jdW1lbnRvczogJHtBcnJheU9mRmlsZU5hbWVBdHRhY2htZW50cyhhdHRhY2htZW50cyl9YCkKCiAgbGV0IG5vdFByb2NjZXNpbmcgPSBhdHRhY2htZW50cy5maWx0ZXIoKHsgZmlsZW5hbWUgfSkgPT4gY2hlY2tJZkZpbGVFeGlzdHMoYCR7cGF0aH0ke2ZpbGVuYW1lfWApKQogIG5vdFByb2NjZXNpbmcuZm9yRWFjaCgoeyBmaWxlbmFtZSB9KSA9PiBjb25zb2xlLmxvZyhgZWwgZG9jdW1lbnRvICR7ZmlsZW5hbWV9IHlhIGV4aXN0ZSBlbiAke3BhdGh9YCkpCgogIGRvd25sb2FkQXR0YWNobWVudHNCeUV4dGVuc2lvbihhdHRhY2htZW50cywgJ3BkZicpCgp9Cgpjb25zdCBkb3dubG9hZEF0dGFjaG1lbnRzQnlFeHRlbnNpb24gPSAoYXR0YWNobWVudHMsIGV4dGVuc2lvbikgPT4gewoKICBpZiAoY2hlY2tJZkF0dGFjaG1lbnRzRXhpc3RzKCkpIGNvbnNvbGUubG9nKCdObyBzZSBlbmNvbnRyYXJvbiBkb2N1bWVudG9zJykKCiAgYXR0YWNobWVudHMKICAgIC5maWx0ZXIoKHsgZmlsZW5hbWUgfSkgPT4gIWNoZWNrSWZGaWxlRXhpc3RzKGAke3BhdGh9JHtmaWxlbmFtZX1gKSAmJiBmaWxlbmFtZS5lbmRzV2l0aChleHRlbnNpb24pKQogICAgLmZvckVhY2goKHsgZmlsZW5hbWUsIGRhdGEgfSkgPT4gewogICAgICBmcy53cml0ZUZpbGVTeW5jKGAke3BhdGh9JHtmaWxlbmFtZX1gLCBkYXRhKQogICAgICBjb25zb2xlLmxvZyhgU2UgY3JlYXJvbiBsb3Mgc2lndWllbnRlcyBkb2N1bWVudG9zOiAke2ZpbGVuYW1lfSBlbiAke3BhdGh9YCkKICAgIH0pCgp9Cgpjb25zdCBBcnJheU9mRmlsZU5hbWVBdHRhY2htZW50cyA9IGF0dGFjaG1lbnRzID0+IHsKCiAgbGV0IGZpbGVOYW1lQXJyYXkgPSBbXQoKICBhdHRhY2htZW50cy5maWx0ZXIoKHsgZmlsZW5hbWUgfSkgPT4gZmlsZU5hbWVBcnJheS5wdXNoKGZpbGVuYW1lKSkKCiAgcmV0dXJuIGZpbGVOYW1lQXJyYXkKCn0KY29uc3QgY2hlY2tJZkF0dGFjaG1lbnRzRXhpc3RzID0gYXR0YWNobWVudHMgPT4gewoKICBpZiAoQXJyYXkuaXNBcnJheShhdHRhY2htZW50cykgJiYgYXR0YWNobWVudHMubGVuZ3RoID4gMCkgewoKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCmNvbnN0IGNoZWNrSWZGaWxlRXhpc3RzID0gcGF0aCA9PiBmcy5leGlzdHNTeW5jKHBhdGgpCgpjb25zdCBmZXRjaE1lc3NhZ2VzID0gYXN5bmMgKGNvbm5lY3Rpb24pID0+IHsKICAvLyBGZXRjaCBlbWFpbHMgZnJvbSB0aGUgbGFzdCAyNGgKICBsZXQgZGVsYXkgPSAyNCAqIDM2MDAgKiAxMDAwOwogIGxldCB5ZXN0ZXJkYXkgPSBuZXcgRGF0ZSgpOwogIHllc3RlcmRheS5zZXRUaW1lKERhdGUubm93KCkgLSBkZWxheSk7CiAgeWVzdGVyZGF5ID0geWVzdGVyZGF5LnRvSVNPU3RyaW5nKCk7CiAgbGV0IHNlYXJjaENyaXRlcmlhID0gWydVTlNFRU4nLCBbJ1NJTkNFJywgeWVzdGVyZGF5XV07CiAgbGV0IGZldGNoT3B0aW9ucyA9IHsgYm9kaWVzOiBbJ0hFQURFUi5GSUVMRFMgKEZST00gVE8gU1VCSkVDVCBEQVRFKSddLCBzdHJ1Y3Q6IHRydWUgfTsKCiAgLy8gcmV0cmlldmUgb25seSB0aGUgaGVhZGVycyBvZiB0aGUgbWVzc2FnZXMKICByZXR1cm4gY29ubmVjdGlvbi5zZWFyY2goc2VhcmNoQ3JpdGVyaWEsIGZldGNoT3B0aW9ucykKfQoKY29uc3QgZXh0cmFjdEF0dGFjaGVtZW50cyA9IGFzeW5jIChtZXNzYWdlcywgY29ubmVjdGlvbikgPT4gewogIGxldCBhdHRhY2htZW50cyA9IFtdCgogIG1lc3NhZ2VzLmZvckVhY2goZnVuY3Rpb24gKG1lc3NhZ2UpIHsKICAgIGxldCBwYXJ0cyA9IGltYXBzLmdldFBhcnRzKG1lc3NhZ2UuYXR0cmlidXRlcy5zdHJ1Y3QpOwoKICAgIGxldCBhdHRhY2htZW50UHJvbWlzZSA9IHBhcnRzCiAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHBhcnQpIHsKCiAgICAgICAgcmV0dXJuIHBhcnQuZGlzcG9zaXRpb24gJiYgcGFydC5kaXNwb3NpdGlvbi50eXBlLnRvVXBwZXJDYXNlKCkgPT09ICdBVFRBQ0hNRU5UJzsKICAgICAgfSkKICAgICAgLm1hcChhc3luYyBmdW5jdGlvbiAocGFydCkgewoKICAgICAgICAvLyByZXRyaWV2ZSB0aGUgYXR0YWNobWVudHMgb25seSBvZiB0aGUgbWVzc2FnZXMgd2l0aCBhdHRhY2htZW50cwogICAgICAgIGxldCBwYXJ0RGF0YSA9IGF3YWl0IGNvbm5lY3Rpb24uZ2V0UGFydERhdGEobWVzc2FnZSwgcGFydCkKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGZpbGVuYW1lOiBwYXJ0LmRpc3Bvc2l0aW9uLnBhcmFtcy5maWxlbmFtZSwKICAgICAgICAgIGRhdGE6IHBhcnREYXRhCgogICAgICAgIH0KICAgICAgfSkKICAgIGlmIChBcnJheS5pc0FycmF5KGF0dGFjaG1lbnRQcm9taXNlKSAmJiBhdHRhY2htZW50UHJvbWlzZS5sZW5ndGggPiAwICYmIGF0dGFjaG1lbnRQcm9taXNlLmZpbGVuYW1lICE9PSAnKi5wZGYnKSB7CiAgICAgIGF0dGFjaG1lbnRzID0gYXR0YWNobWVudHMuY29uY2F0KGF0dGFjaG1lbnRQcm9taXNlKQogICAgfQoKICB9KTsKICByZXR1cm4gUHJvbWlzZS5hbGwoYXR0YWNobWVudHMpCgp9CgptYWluKCkKCgoK"}}