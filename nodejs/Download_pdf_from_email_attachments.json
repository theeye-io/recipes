{"task":{"enable":true,"type":"script","public":false,"tags":[],"grace_time":0,"task_arguments":[{"id":1,"order":0,"type":"fixed","label":"user","value":"email-user","help":"","readonly":true,"required":true,"masked":false,"options":[]},{"id":2,"order":1,"type":"input","label":"password","help":"","readonly":false,"required":true,"masked":true,"charsmin":0,"charsmax":0,"charset":null,"pattern":"","options":[]}],"output_parameters":[],"register_body":false,"execution_count":0,"multitasking":true,"user_inputs":false,"user_inputs_members":[],"show_result":false,"script_arguments":[{"id":1,"order":0,"type":"fixed","label":"user","value":"email-user","help":"","readonly":true,"required":true,"masked":false,"options":[]},{"id":2,"order":1,"type":"input","label":"password","help":"","readonly":false,"required":true,"masked":true,"charsmin":0,"charsmax":0,"charset":null,"pattern":"","options":[]}],"logging":false,"_type":"ScriptTask","creation_date":"2020-07-06T18:28:04.722Z","last_update":"2020-07-06T18:28:04.724Z","env":{"PATH":"Download pdf path","HOST":"Mail Host","PORT":"PORT","TLS":"boolean"},"name":"Download pdf from email attachments","description":"","timeout":600000,"script_runas":"/usr/bin/env node %script%","source_model_id":"5f036d34a4b84d00138ee3a6","script_id":"5eff3d02f3707500121286ea"},"file":{"filename":"downloadAllAttachments.js","keyname":"downloadAllAttachments.js[ts:1594046953929]","mimetype":"text/javascript","extension":"js","size":3254,"description":"","md5":"c0f4358cec286ee6ea82f8750dfcef3b","public":false,"tags":[],"source_model_id":"5eff3d02f3707500121286ea","data":"bGV0IGltYXBzID0gcmVxdWlyZSgnaW1hcC1zaW1wbGUnKTsKbGV0IGZzID0gcmVxdWlyZSgnZnMnKTsKY29uc3QgcGF0aCA9IHByb2Nlc3MuZW52LlBBVEg7CmxldCBjb25maWcgPSB7CiAgaW1hcDogewogICAgdXNlcjogcHJvY2Vzcy5hcmd2WzJdLAogICAgcGFzc3dvcmQ6IHByb2Nlc3MuYXJndlszXSwKICAgIGhvc3Q6IHByb2Nlc3MuZW52LkhPU1QsCiAgICBwb3J0OiBwcm9jZXNzLmVudi5QT1JULAogICAgdGxzOiBwcm9jZXNzLmVudi5UTFMsIC8vYm9vbGVhbgogICAgYXV0aFRpbWVvdXQ6IDMwMDAKICB9Cn0KCmNvbnN0IG1haW4gPSBhc3luYyAoKSA9PiB7CiAgdHJ5IHsKICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBpbWFwcy5jb25uZWN0KGNvbmZpZykKICAgIGF3YWl0IGNvbm5lY3Rpb24ub3BlbkJveCgnSU5CT1gnKQogICAgbGV0IG1lc3NhZ2VzID0gYXdhaXQgZmV0Y2hNZXNzYWdlcyhjb25uZWN0aW9uKQogICAgbGV0IGF0dGFjaG1lbnRzID0gYXdhaXQgZXh0cmFjdEF0dGFjaGVtZW50cyhtZXNzYWdlcywgY29ubmVjdGlvbikKICAgIHByb2Nlc3NBdHRhY2htZW50cyhhdHRhY2htZW50cykKICAgIGNvbm5lY3Rpb24uZW5kKCkKICAgIGNvbnN0IG91dHB1dCA9IHsgInN0YXRlIjogInN1Y2Nlc3MiLCAiZGF0YSI6IHt9IH0KICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KG91dHB1dCkpCiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLmVycm9yKGVycikKICAgIGNvbnNvbGUuZXJyb3IoImZhaWx1cmUiKQogICAgY29ubmVjdGlvbi5lbmQoKQogIH0KfQoKY29uc3QgcHJvY2Vzc0F0dGFjaG1lbnRzID0gYXR0YWNobWVudHMgPT4gewoKICBpZiAoY2hlY2tJZkF0dGFjaG1lbnRzRXhpc3RzKCkpIGNvbnNvbGUubG9nKCdObyBzZSBlbmNvbnRyYXJvbiBkb2N1bWVudG9zJykKICAKICBjb25zb2xlLmxvZyhgU2UgZW5jb250YXJvbiBsb3Mgc2lndWllbnRlcyBkb2N1bWVudG9zOiAke0FycmF5T2ZGaWxlTmFtZUF0dGFjaG1lbnRzKGF0dGFjaG1lbnRzKX1gKQoKICBsZXQgbm90UHJvY2Nlc2luZyA9IGF0dGFjaG1lbnRzLmZpbHRlcigoeyBmaWxlbmFtZSB9KSA9PiBjaGVja0lmRmlsZUV4aXN0cyhgJHtwYXRofSR7ZmlsZW5hbWV9YCkpCiAgbm90UHJvY2Nlc2luZy5mb3JFYWNoKCh7IGZpbGVuYW1lIH0pID0+IGNvbnNvbGUubG9nKGBlbCBkb2N1bWVudG8gJHtmaWxlbmFtZX0geWEgZXhpc3RlIGVuICR7cGF0aH1gKSkKIAogIGRvd25sb2FkQXR0YWNobWVudHMoYXR0YWNobWVudHMpCgp9Cgpjb25zdCBkb3dubG9hZEF0dGFjaG1lbnRzID0gYXR0YWNobWVudHMgPT4gewoKICBhdHRhY2htZW50cwogIC5maWx0ZXIoKHsgZmlsZW5hbWUgfSkgPT4gIWNoZWNrSWZGaWxlRXhpc3RzKGAke3BhdGh9JHtmaWxlbmFtZX1gKSkKICAuZm9yRWFjaCgoeyBmaWxlbmFtZSwgZGF0YSB9KSA9PiB7CiAgICBmcy53cml0ZUZpbGVTeW5jKGAke3BhdGh9JHtmaWxlbmFtZX1gLCBkYXRhKQogICAgY29uc29sZS5sb2coYFNlIGNyZWFyb24gbG9zIHNpZ3VpZW50ZXMgZG9jdW1lbnRvczogJHtmaWxlbmFtZX0gZW4gJHtwYXRofWApCiAgfSkKCn0KCmNvbnN0IEFycmF5T2ZGaWxlTmFtZUF0dGFjaG1lbnRzID0gYXR0YWNobWVudHMgPT4gewoKICBsZXQgZmlsZU5hbWVBcnJheSA9IFtdCiAgCiAgYXR0YWNobWVudHMuZmlsdGVyKCh7IGZpbGVuYW1lIH0pID0+IGZpbGVOYW1lQXJyYXkucHVzaChmaWxlbmFtZSkpCgogIHJldHVybiBmaWxlTmFtZUFycmF5Cgp9CmNvbnN0IGNoZWNrSWZBdHRhY2htZW50c0V4aXN0cyA9IGF0dGFjaG1lbnRzID0+IHsKCiAgaWYgKEFycmF5LmlzQXJyYXkoYXR0YWNobWVudHMpICYmIGF0dGFjaG1lbnRzLmxlbmd0aCA+IDApIHsKCiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9Cgpjb25zdCBjaGVja0lmRmlsZUV4aXN0cyA9IHBhdGggPT4gZnMuZXhpc3RzU3luYyhwYXRoKQoKY29uc3QgZmV0Y2hNZXNzYWdlcyA9IGFzeW5jIChjb25uZWN0aW9uKSA9PiB7CiAgLy8gRmV0Y2ggZW1haWxzIGZyb20gdGhlIGxhc3QgMjRoCiAgbGV0IGRlbGF5ID0gMjQgKiAzNjAwICogMTAwMDsKICBsZXQgeWVzdGVyZGF5ID0gbmV3IERhdGUoKTsKICB5ZXN0ZXJkYXkuc2V0VGltZShEYXRlLm5vdygpIC0gZGVsYXkpOwogIHllc3RlcmRheSA9IHllc3RlcmRheS50b0lTT1N0cmluZygpOwogIGxldCBzZWFyY2hDcml0ZXJpYSA9IFsnVU5TRUVOJywgWydTSU5DRScsIHllc3RlcmRheV1dOwogIGxldCBmZXRjaE9wdGlvbnMgPSB7IGJvZGllczogWydIRUFERVIuRklFTERTIChGUk9NIFRPIFNVQkpFQ1QgREFURSknXSwgc3RydWN0OiB0cnVlIH07CgogIC8vIHJldHJpZXZlIG9ubHkgdGhlIGhlYWRlcnMgb2YgdGhlIG1lc3NhZ2VzCiAgcmV0dXJuIGNvbm5lY3Rpb24uc2VhcmNoKHNlYXJjaENyaXRlcmlhLCBmZXRjaE9wdGlvbnMpCn0KCmNvbnN0IGV4dHJhY3RBdHRhY2hlbWVudHMgPSBhc3luYyAobWVzc2FnZXMsIGNvbm5lY3Rpb24pID0+IHsKICBsZXQgYXR0YWNobWVudHMgPSBbXQoKICBtZXNzYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChtZXNzYWdlKSB7CiAgICBsZXQgcGFydHMgPSBpbWFwcy5nZXRQYXJ0cyhtZXNzYWdlLmF0dHJpYnV0ZXMuc3RydWN0KTsKCiAgICBsZXQgYXR0YWNobWVudFByb21pc2UgPSBwYXJ0cwogICAgICAuZmlsdGVyKGZ1bmN0aW9uIChwYXJ0KSB7CgogICAgICAgIHJldHVybiBwYXJ0LmRpc3Bvc2l0aW9uICYmIHBhcnQuZGlzcG9zaXRpb24udHlwZS50b1VwcGVyQ2FzZSgpID09PSAnQVRUQUNITUVOVCc7CiAgICAgIH0pCiAgICAgIC5tYXAoYXN5bmMgZnVuY3Rpb24gKHBhcnQpIHsKCiAgICAgICAgLy8gcmV0cmlldmUgdGhlIGF0dGFjaG1lbnRzIG9ubHkgb2YgdGhlIG1lc3NhZ2VzIHdpdGggYXR0YWNobWVudHMKICAgICAgICBsZXQgcGFydERhdGEgPSBhd2FpdCBjb25uZWN0aW9uLmdldFBhcnREYXRhKG1lc3NhZ2UsIHBhcnQpCgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBmaWxlbmFtZTogcGFydC5kaXNwb3NpdGlvbi5wYXJhbXMuZmlsZW5hbWUsCiAgICAgICAgICBkYXRhOiBwYXJ0RGF0YQoKICAgICAgICB9CiAgICAgIH0pCiAgICBpZiAoQXJyYXkuaXNBcnJheShhdHRhY2htZW50UHJvbWlzZSkgJiYgYXR0YWNobWVudFByb21pc2UubGVuZ3RoID4gMCkgewogICAgICBhdHRhY2htZW50cyA9IGF0dGFjaG1lbnRzLmNvbmNhdChhdHRhY2htZW50UHJvbWlzZSkKICAgIH0KCiAgfSk7CiAgcmV0dXJuIFByb21pc2UuYWxsKGF0dGFjaG1lbnRzKQoKfQoKbWFpbigpCgo="}}